module Adsb.IcaoId where

import Numeric
import Data.Bits

type CountryCode = String
type CountryName = String
type Prefix      = Int
type PrefixSize  = Int

-- data from http://www.kloth.net/radio/icao24alloc.php
-- and ISO-3166-1 alpha-2 country codes from
-- https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2

prefixes = [
	("US", "United States", 10, 4),
	("RU", "Russian Federation", 1, 4),
	("AU", "Australia", 31, 6),
	("IN", "India", 32, 6),
	("IT", "Italy", 12, 6),
	("AR", "Argentina", 56, 6),
	("JP", "Japan", 33, 6),
	("DE", "Germany", 15, 6),
	("CN", "China", 30, 6),
	("CA", "Canada", 48, 6),
	("GB", "United Kingdom", 16, 6),
	("FR", "France", 14, 6),
	("BR", "Brazil", 57, 6),
	("ES", "Spain", 13, 6),
	("DK", "Denmark", 139, 9),
	("BE", "Belgium", 137, 9),
	("SY", "Syrian Arab Republic", 239, 9),
	("CH", "Switzerland", 150, 9),
	("SE", "Sweden", 149, 9),
	("LK", "Sri Lanka", 238, 9),
	("TN", "Tunisia", 5, 9),
	("ZA", "South Africa", 1, 9),
	("TR", "Turkey", 151, 9),
	("SG", "Singapore", 237, 9),
	("BG", "Bulgaria", 138, 9),
	("SA", "Saudi Arabia", 226, 9),
	("UA", "Ukraine", 161, 9),
	("RO", "Romania", 148, 9),
	("KR", "Republic of Korea", 227, 9),
	("TH", "Thailand", 272, 9),
	("PT", "Portugal", 146, 9),
	("PL", "Poland", 145, 9),
	("PH", "Philippines", 235, 9),
	("PK", "Pakistan", 236, 9),
	("AT", "Austria", 136, 9),
	("NO", "Norway", 143, 9),
	("NZ", "New Zealand", 400, 9),
	("NL", "Netherlands, Kingdom of the", 144, 9),
	("MA", "Morocco", 4, 9),
	("MX", "Mexico", 26, 9),
	("MY", "Malaysia", 234, 9),
	("LY", "Libyan Arab Jamahiriya", 3, 9),
	("LB", "Lebanon", 233, 9),
	("JO", "Jordan", 232, 9),
	("CZ", "Czech Republic", 147, 9),
	("KP", "Democratic People's Republic of Korea", 228, 9),
	("VE", "Venezuela", 27, 9),
	("VN", "Viet Nam", 273, 9),
	("IL", "Israel", 231, 9),
	("IQ", "Iraq", 229, 9),
	("IR", "Iran, Islamic Republic of", 230, 9),
	("EG", "Egypt", 2, 9),
	("ID", "Indonesia", 276, 9),
	("YU", "Yugoslavia", 152, 9),
	("HU", "Hungary", 142, 9),
	("GR", "Greece", 141, 9),
	("DZ", "Algeria", 20, 9),
	("--", "ICAO (temporary)", 480, 9),
	("FI", "Finland", 140, 9),
	("AF", "Afghanistan", 1792, 12),
	("GA", "Gabon", 62, 12),
	("GM", "Gambia", 154, 12),
	("AO", "Angola", 144, 12),
	("ET", "Ethiopia", 64, 12),
	("GH", "Ghana", 68, 12),
	("ZM", "Zambia", 138, 12),
	("YE", "Yemen", 2192, 12),
	("GT", "Guatemala", 180, 12),
	("GN", "Guinea", 70, 12),
	("UY", "Uruguay", 3728, 12),
	("GY", "Guyana", 182, 12),
	("HT", "Haiti", 184, 12),
	("HN", "Honduras", 186, 12),
	("TZ", "United Republic of Tanzania", 128, 12),
	("IS", "Iceland", 1228, 12),
	("GQ", "Equatorial Guinea", 66, 12),
	("SV", "El Salvador", 178, 12),
	("EC", "Ecuador", 3716, 12),
	("DO", "Dominican Republic", 196, 12),
	("GB", "Ireland", 1226, 12),
	("BS", "Bahamas", 168, 12),
	("FJ", "Fiji", 3208, 12),
	("JM", "Jamaica", 190, 12),
	("CD", "Democratic Republic of the Congo", 140, 12),
	("AE", "United Arab Emirates", 2198, 12),
	("BH", "Bahrain", 2196, 12),
	("KE", "Kenya", 76, 12),
	("UG", "Uganda", 104, 12),
	("KW", "Kuwait", 1798, 12),
	("BD", "Bangladesh", 1794, 12),
	("LA", "Lao People's Democratic Republic", 1800, 12),
	("TT", "Trinidad and Tobago", 198, 12),
	("CU", "Cuba", 176, 12),
	("TG", "Togo", 136, 12),
	("LR", "Liberia", 80, 12),
	("SR", "Suriname", 200, 12),
	("CL", "Chile", 3712, 12),
	("BO", "Bolivia", 3732, 12),
	("MG", "Madagascar", 84, 12),
	("MW", "Malawi", 88, 12),
	("CI", "CÃ´te d Ivoire", 56, 12),
	("SO", "Somalia", 120, 12),
	("ML", "Mali", 92, 12),
	("SN", "Senegal", 112, 12),
	("BF", "Burkina Faso", 156, 12),
	("RW", "Rwanda", 110, 12),
	("BI", "Burundi", 50, 12),
	("CR", "Costa Rica", 174, 12),
	("KH", "Cambodia", 1806, 12),
	("CM", "Cameroon", 52, 12),
	("CF", "Central African Republic", 108, 12),
	("TD", "Chad", 132, 12),
	("PE", "Peru", 3724, 12),
	("MZ", "Mozambique", 6, 12),
	("MM", "Myanmar", 1796, 12),
	("PY", "Paraguay", 3720, 12),
	("PG", "Papua New Guinea", 2200, 12),
	("NP", "Nepal", 1802, 12),
	("CD", "Congo", 54, 12),
	("PA", "Panama", 194, 12),
	("NI", "Nicaragua", 192, 12),
	("NE", "Niger", 98, 12),
	("NG", "Nigeria", 100, 12),
	("CO", "Colombia", 172, 12),
	("SD", "Sudan", 124, 12),
	("OM", "Oman", 7216, 14),
	("PW", "Palau", 6672, 14),
	("KM", "Comoros", 212, 14),
	("NR", "Nauru", 12840, 14),
	("NA", "Namibia", 2052, 14),
	("CK", "Cook Islands", 9220, 14),
	("ME", "Montenegro", 5208, 14),
	("MN", "Mongolia", 6664, 14),
	("CV", "Cape Verde", 600, 14),
	("QA", "Qatar", 424, 14),
	("MC", "Monaco", 4944, 14),
	("MD", "Republic of Moldova", 5139, 14),
	("FM", "Micronesia, Federated States of", 6660, 14),
	("MU", "Mauritius", 384, 14),
	("MR", "Mauritania", 376, 14),
	("LC", "Saint Lucia", 12848, 14),
	("VC", "Saint Vincent and the Grenadines", 752, 14),
	("AS", "Samoa", 9224, 14),
	("SM", "San Marino", 5120, 14),
	("ST", "Sao Tome and Principe", 632, 14),
	("MH", "Marshall Islands", 9216, 14),
	("MT", "Malta", 4936, 14),
	("SC", "Seychelles", 464, 14),
	("SL", "Sierra Leone", 472, 14),
	("BN", "Brunei Darussalam", 8788, 14),
	("SK", "Slovakia", 5143, 14),
	("SI", "Slovenia", 5147, 14),
	("SB", "Solomon Islands", 8796, 14),
	("MV", "Maldives", 360, 14),
	("BW", "Botswana", 192, 14),
	("BA", "Bosnia and Herzegovina", 5196, 14),
	("LU", "Luxembourg", 4928, 14),
	("LT", "Lithuania", 5135, 14),
	("HR", "Croatia", 5127, 14),
	("SZ", "Swaziland", 488, 14),
	("BT", "Bhutan", 6656, 14),
	("BJ", "Benin", 592, 14),
	("BZ", "Belize", 684, 14),
	("TJ", "Tajikistan", 5204, 14),
	("BY", "Belarus", 5184, 14),
	("MK", "The former Yugoslav Republic of Macedonia", 5192, 14),
	("LS", "Lesotho", 296, 14),
	("TO", "Tonga", 12852, 14),
	("LV", "Latvia", 5131, 14),
	("BB", "Barbados", 680, 14),
	("KG", "Kyrgyzstan", 6148, 14),
	("TM", "Turkmenistan", 6150, 14),
	("KI", "Kiribati", 12856, 14),
	("KZ", "Kazakhstan", 6668, 14),
	("CY", "Cyprus", 4896, 14),
	("DJ", "Djibouti", 608, 14),
	("ER", "Eritrea", 2056, 14),
	("AZ", "Azerbaijan", 6146, 14),
	("GW", "Guinea-Bissau", 288, 14),
	("UZ", "Uzbekistan", 5151, 14),
	("VU", "Vanuatu", 12864, 14),
	("AM", "Armenia", 6144, 14),
	("AG", "Antigua and Barbuda", 808, 14),
	("GD", "Grenada", 816, 14),
	("EE", "Estonia", 5188, 14),
	("ZW", "Zimbabwe", 16, 14),
	("GE", "Georgia", 5200, 14),
	("AL", "Albania", 5124, 14),
	("--", "ICAO (special use)", 8804, 14),
	("--", "ICAO (special use)", 15396, 14)]

-- get the country code and name from an ICAO id in hex format
countryFromIcaoId :: String -> Maybe (CountryCode, CountryName, Prefix, PrefixSize)
countryFromIcaoId hex =
	case matchingPrefixes of
		[]     -> Nothing
		_      -> Just $ head matchingPrefixes
	where
		matchingPrefixes = filter (prefixMatches hex) prefixes

-- the prefix matches if the upper prefixSize bits of hex match the prefix
-- (i.e. shift right by 24 - prefixSize and compare)
prefixMatches :: String -> (CountryCode, CountryName, Prefix, PrefixSize) -> Bool
prefixMatches hex (cc, cn, prefix, prefixSize) =
	(fst $ head $ readHex hex) `shiftR` (24 - prefixSize) == prefix
